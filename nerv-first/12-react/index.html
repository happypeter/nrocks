<!DOCTYPE html><html lang="en"><head><title data-react-helmet="true">基于 React 开发 DApp</title><link rel="preload" as="script" href="/nrocks/bootstrap.2a9c3808.js"/><link rel="preload" as="script" href="/nrocks/templates/src/containers/EpisodeContainer.53a275f5.js"/><link rel="preload" as="script" href="/nrocks/main.727cb2d6.js"/><link rel="preload" as="style" href="/nrocks/styles.de08a35c.css"/><link rel="stylesheet" href="/nrocks/styles.de08a35c.css"/><meta charSet="UTF-8"/><meta name="viewport" content="minimum-scale=1, initial-scale=1, width=device-width, shrink-to-fit=no"/><link rel="icon" type="image/x-icon" href="images/favicon.ico"/><link rel="shortcut icon" type="image/x-icon" href="images/favicon.ico"/><meta name="description" content="nervos"/><meta name="keywords" content="Nervos Blockchain Crypto DApp"/><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css"/></head><body><div id="root"><div data-reactroot=""><div><div class="jss1"><div class="jss7"><div><div class="jss31"><div class="jss41"><div class="jss52 jss54 jss42 jss18 jss43 jss47"><div class="jss22"><div class="jss16 jss17"><button tabindex="0" class="jss85 jss79" type="button"><span class="jss84"><svg class="jss88" focusable="false" viewBox="0 0 24 24" aria-hidden="true" role="presentation"><path d="M0 0h24v24H0z" fill="none"></path><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"></path></svg></span></button></div><div class="jss19"><a class="jss20" href="/nrocks/nerv-first/0-intro"><p class="jss97 jss106 jss21">课程简介</p></a><a class="jss20" href="/nrocks/nerv-first/1-dapp"><p class="jss97 jss106 jss21">什么是 DApp ？</p></a><a class="jss20" href="/nrocks/nerv-first/2-nervos"><p class="jss97 jss106 jss21">什么是 Nervos ？</p></a><a class="jss20" href="/nrocks/nerv-first/3-dev"><p class="jss97 jss106 jss21">智能合约入门</p></a><a class="jss20" href="/nrocks/nerv-first/4-sol"><p class="jss97 jss106 jss21">合约编程语言 Solidity</p></a><a class="jss20" href="/nrocks/nerv-first/5-rpc"><p class="jss97 jss106 jss21">HTTP 请求和 JSON-RPC</p></a><a class="jss20" href="/nrocks/nerv-first/6-wallet"><p class="jss97 jss106 jss21">什么是加密货币钱包？</p></a><a class="jss20" href="/nrocks/nerv-first/7-coin"><p class="jss97 jss106 jss21">申请测试链代币</p></a><a class="jss20" href="/nrocks/nerv-first/8-deploy-1"><p class="jss97 jss106 jss21">部署智能合约 part1</p></a><a class="jss20" href="/nrocks/nerv-first/9-deploy-2"><p class="jss97 jss106 jss21">部署智能合约 part2</p></a><a class="jss20" href="/nrocks/nerv-first/10-interact"><p class="jss97 jss106 jss21">与合约交互</p></a><a class="jss20" href="/nrocks/nerv-first/11-gas"><p class="jss97 jss106 jss21">以太坊的 Gas 机制</p></a><a class="jss20 active" aria-current="page" href="/nrocks/nerv-first/12-react"><p class="jss97 jss106 jss21">基于 React 开发 DApp</p></a><a class="jss20" href="/nrocks/nerv-first/13-neuron"><p class="jss97 jss106 jss21">Neuron 钱包作为 DApp 的运行环境</p></a></div></div><a class="jss23 active" aria-current="page" href="/nrocks/nerv-first"><svg class="jss88 jss24" focusable="false" viewBox="0 0 24 24" aria-hidden="true" role="presentation"><path d="M0 0h24v24H0z" fill="none"></path><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"></path></svg><span class="jss97 jss107 jss25">基于 Nervos AppChain 的 DApp 开发</span></a></div></div></div></div><div class="jss8"><div class="docSearch-content jss9"><h1 class="jss97 jss102 jss10">基于 React 开发 DApp</h1><a href="https://www.bilibili.com/video/av32531648/" class="jss11" target="_blank"><svg viewBox="0 0 24 24" width="32" height="32" fill="#45c289"><path d="M0 0h24v24H0z" fill="none"></path><path d="M10 16.5l6-4.5-6-4.5v9zM12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"></path></svg><h3 class="jss97 jss104 jss12">到 B 站观看视频</h3></a><div class="jss123"><p>之前完成了使用 Nodejs 脚本的形式跟合约进行交互，但是实际上用户还是希望能有一个美观的 UI 可以用的。所以这节咱们就来基于 react 技术开发 DApp ，实现跟合约的交互。本节的最终代码都在 Github 仓库中的 dapp1 文件夹中：<a href="https://github.com/happypeter/NervFirst/tree/master/dapp1">https://github.com/happypeter/NervFirst/tree/master/dapp1</a> 。下面我们来说说具体的开发思路。</p>
<h2 id="总体思路">总体思路 <a class="header-anchor" href="#总体思路" aria-hidden="true">¶</a></h2>
<p>先来说说 DApp 的总体架构。起码截止到目前，DApp 开发还是以 Web 架构为主，也就是说是可以跑到浏览器内的。本节我们使用 React 技术来开发 DApp 应用，这个在业界也是非常流行的，例如著名的 steemit 项目就是用 react 开发的，当然理论上讲任何的 Web 技术，或者是用 ios 或者 andriod 原生应用都可以开发 DApp 的。</p>
<p>我们本节开发的 DApp 跟真实的 DApp 还是有一个明显的不同，因为本节会承接上一节，继续把 DApp 使用者的账户信息，包括私钥，保存到源码中。这样，当 DApp 跟合约交互的时候，底层的 Nervos.js 会直接调用私钥进行签名，整个签名过程从界面上是看不到的。后续的小节中，我们会把私钥信息移除，采用 Nervos 官方的 DApp 钱包 neuron 来完成交易签名，不带私钥的源码才是正确的开发 DApp 的方式，因为只有这样每个用户才可以用自己的 Neuron 钱包打开 DApp ，去使用自己的账户去发交易，跟合约进行交互。当然这是后话。</p>
<p>本节中我们基本的思路就是把之前 interact 文件夹中的必要文件都拷贝到 react 项目中，然后就可以在浏览器中去跟智能合约进行交互了。</p>
<h2 id="实现读取操作">实现读取操作 <a class="header-anchor" href="#实现读取操作" aria-hidden="true">¶</a></h2>
<p>先来创建一个新的 react 项目，然后把必要的文件内容拷贝过来，实现读取链上数据的操作。</p>
<pre><code>create<span class="token operator">-</span>react<span class="token operator">-</span>app dapp1
yarn add @nervos<span class="token operator">/</span>chain
</code></pre>
<p>我们通过 create-react-app 这个脚手架工具来生成项目，如果系统上没有这个命令需要提前 npm 全局安装一下。项目的名字叫 dapp1 ，在本文开始给大家的链接中可以看到 dapp1 中的最终代码。进入项目安装一下 Nervos.js 。</p>
<p>下面把 interact/ 中的各个不需要改动的文件直接拷贝到 dapp1/src 中。 需要拷贝的文件包括 config.js ，nervos.js ，simpleStore.js 和 transaction.js 。</p>
<p>App.js</p>
<pre><code class="language-js"><span class="token keyword">const</span> nervos <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./nervos'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> simpleStore <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./simpleStore'</span><span class="token punctuation">)</span>

 componentDidMount <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token keyword">from</span> <span class="token operator">=</span>
      nervos<span class="token punctuation">.</span>appchain<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>wallet<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span>
      nervos<span class="token punctuation">.</span>appchain<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>wallet<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>address

    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'from'</span><span class="token punctuation">,</span> <span class="token keyword">from</span><span class="token punctuation">)</span>

    <span class="token keyword">const</span> times <span class="token operator">=</span> <span class="token keyword">await</span> simpleStore<span class="token punctuation">.</span>simpleStoreContract<span class="token punctuation">.</span>methods<span class="token punctuation">.</span><span class="token function">getList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token keyword">from</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'times'</span><span class="token punctuation">,</span> times<span class="token punctuation">)</span>
    <span class="token keyword">const</span> messages <span class="token operator">=</span> <span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>
      times<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>time <span class="token operator">=></span>
        simpleStore<span class="token punctuation">.</span>simpleStoreContract<span class="token punctuation">.</span>methods<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span>time<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token keyword">from</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'messages'</span><span class="token punctuation">,</span> messages<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</code></pre>
<p>接下来到 App.js 中完成读取链上数据的操作。首先导入 nervos 和 simpleStore ，然后需要添加一个异步的 <code>componentDidMount</code> 函数，这个函数会在页面加载后自动执行。里面的内容就直接拷贝 interact/index.js 中的读取相关的代码即可。</p>
<pre><code>yarn start
</code></pre>
<p>启动项目，浏览器中打开 console 可以看到顺利读取到了链上的数据。</p>
<h2 id="写操作">写操作 <a class="header-anchor" href="#写操作" aria-hidden="true">¶</a></h2>
<p>接下来完成写操作。也是基本拷贝 interact/index.js 中的内容，配上一点点 React 的受控组件的小知识。</p>
<p>App.js</p>
<pre><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    msg<span class="token punctuation">:</span> <span class="token string">''</span>
  <span class="token punctuation">}</span>
  <span class="token function-variable function">handleChange</span> <span class="token operator">=</span> e <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      msg<span class="token punctuation">:</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  handleSubmit <span class="token operator">=</span> <span class="token keyword">async</span> e <span class="token operator">=></span> <span class="token punctuation">{</span>
    e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> msg <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state
    <span class="token keyword">const</span> time <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">const</span> current <span class="token operator">=</span> <span class="token keyword">await</span> nervos<span class="token punctuation">.</span>appchain<span class="token punctuation">.</span><span class="token function">getBlockNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> tx <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token operator">...</span>simpleStore<span class="token punctuation">.</span>transaction<span class="token punctuation">,</span>
      validUntilBlock<span class="token punctuation">:</span> <span class="token operator">+</span>current <span class="token operator">+</span> <span class="token number">88</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> simpleStore<span class="token punctuation">.</span>simpleStoreContract<span class="token punctuation">.</span>methods
      <span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span> <span class="token operator">+</span>time<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>tx<span class="token punctuation">)</span>

    <span class="token keyword">const</span> receipt <span class="token operator">=</span> <span class="token keyword">await</span> nervos<span class="token punctuation">.</span>listeners<span class="token punctuation">.</span><span class="token function">listenToTransactionReceipt</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>hash<span class="token punctuation">)</span>
    receipt<span class="token punctuation">.</span>errorMessage <span class="token operator">&amp;&amp;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>receipt<span class="token punctuation">.</span>errorMessage<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      msg<span class="token punctuation">:</span> <span class="token string">''</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token operator">...</span>
      <span class="token operator">&lt;</span>form onSubmit<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleSubmit<span class="token punctuation">}</span><span class="token operator">></span>
          <span class="token operator">&lt;</span>label<span class="token operator">></span>
            Name<span class="token punctuation">:</span>
            <span class="token operator">&lt;</span>input
              type<span class="token operator">=</span><span class="token string">"text"</span>
              value<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>msg<span class="token punctuation">}</span>
              onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleChange<span class="token punctuation">}</span>
            <span class="token operator">/</span><span class="token operator">></span>
          <span class="token operator">&lt;</span><span class="token operator">/</span>label<span class="token operator">></span>
          <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">"submit"</span> value<span class="token operator">=</span><span class="token string">"Submit"</span> <span class="token operator">/</span><span class="token operator">></span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>form<span class="token operator">></span>

</code></pre>
<p>添加的 state 值以及 handleChange 函数以及下面的 render 函数中的 form 都是 react 的基础知识，联合起来构成了一个 react 的受控的 input 组件。目的只有一个就是拿到用户输入的字符串。点提交按钮的时候，handleSubmit 函数就会执行。里面可以通过 this.state.msg 拿到用户输入的字符串。所以 react 的内容就是这些。handleSubmit 中其余的内容，跟 interact/index.js 就没有什么区别了。</p>
<p>浏览器中，提交一个留言，点下提交按钮后，界面会僵住几秒钟，当数据写入成功后，input 中的字符串被清空，表示提交成功了。刷新一下页面，终端中也可以看到最新提交的数据。</p>
<h2 id="总结">总结 <a class="header-anchor" href="#总结" aria-hidden="true">¶</a></h2>
<p>到这里，我们就把之前的 interact/ 中实现的跟合约的交互功能移动到 DApp 中了。我们没有实现特别完善的用户体验，因为剩下的工作都是 react 相关技巧了，不是我们本课程的重点。官方的 Demo 仓库中的 first_forever 项目就是最终的效果大家可以去参考：<a href="https://github.com/cryptape/dapp-demos/tree/master/first_forever">https://github.com/cryptape/dapp-demos/tree/master/first_forever</a> 。</p>
<p>同时在咱们课程的仓库中，我也做了镜像：<a href="https://github.com/happypeter/NervFirst/tree/master/complete/first_forever">https://github.com/happypeter/NervFirst/tree/master/complete/first_forever</a> 。</p>
</div><div class="jss124"><a class="jss126" href="/nrocks/nerv-first/11-gas"><svg class="jss88 jss127" focusable="false" viewBox="0 0 24 24" aria-hidden="true" role="presentation"><path d="M0 0h24v24H0z" fill="none"></path><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"></path></svg><div class="jss128"><span class="jss97 jss107 jss129">Previous</span><p class="jss97 jss106">以太坊的 Gas 机制</p></div></a><a class="jss126" href="/nrocks/nerv-first/13-neuron"><div><span class="jss97 jss107 jss129">Next</span><p class="jss97 jss106">Neuron 钱包作为 DApp 的运行环境</p></div><svg class="jss88 jss127" focusable="false" viewBox="0 0 24 24" aria-hidden="true" role="presentation"><path d="M0 0h24v24H0z" fill="none"></path><path d="M12 4l-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z"></path></svg></a></div><hr class="jss13"/><a href="https://github.com/happypeter/ncourse/blob/master/nerv-first/12-react.md" target="_blank" class="jss14"><svg viewBox="0 0 40 40" width="20" height="20" fill="#45c289"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg><p class="jss97 jss106">edit this page on GitHub</p></a></div></div></div></div></div></div></div><style id="jss-server-side">html {
  box-sizing: border-box;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}
*, *::before, *::after {
  box-sizing: inherit;
}
body {
  margin: 0;
  background-color: #fafafa;
}
@media print {
  body {
    background-color: #fff;
  }
}
.jss52 {
  background-color: #fff;
}
.jss53 {
  border-radius: 4px;
}
.jss54 {
  box-shadow: none;
}
.jss55 {
  box-shadow: 0px 1px 3px 0px rgba(0, 0, 0, 0.2),0px 1px 1px 0px rgba(0, 0, 0, 0.14),0px 2px 1px -1px rgba(0, 0, 0, 0.12);
}
.jss56 {
  box-shadow: 0px 1px 5px 0px rgba(0, 0, 0, 0.2),0px 2px 2px 0px rgba(0, 0, 0, 0.14),0px 3px 1px -2px rgba(0, 0, 0, 0.12);
}
.jss57 {
  box-shadow: 0px 1px 8px 0px rgba(0, 0, 0, 0.2),0px 3px 4px 0px rgba(0, 0, 0, 0.14),0px 3px 3px -2px rgba(0, 0, 0, 0.12);
}
.jss58 {
  box-shadow: 0px 2px 4px -1px rgba(0, 0, 0, 0.2),0px 4px 5px 0px rgba(0, 0, 0, 0.14),0px 1px 10px 0px rgba(0, 0, 0, 0.12);
}
.jss59 {
  box-shadow: 0px 3px 5px -1px rgba(0, 0, 0, 0.2),0px 5px 8px 0px rgba(0, 0, 0, 0.14),0px 1px 14px 0px rgba(0, 0, 0, 0.12);
}
.jss60 {
  box-shadow: 0px 3px 5px -1px rgba(0, 0, 0, 0.2),0px 6px 10px 0px rgba(0, 0, 0, 0.14),0px 1px 18px 0px rgba(0, 0, 0, 0.12);
}
.jss61 {
  box-shadow: 0px 4px 5px -2px rgba(0, 0, 0, 0.2),0px 7px 10px 1px rgba(0, 0, 0, 0.14),0px 2px 16px 1px rgba(0, 0, 0, 0.12);
}
.jss62 {
  box-shadow: 0px 5px 5px -3px rgba(0, 0, 0, 0.2),0px 8px 10px 1px rgba(0, 0, 0, 0.14),0px 3px 14px 2px rgba(0, 0, 0, 0.12);
}
.jss63 {
  box-shadow: 0px 5px 6px -3px rgba(0, 0, 0, 0.2),0px 9px 12px 1px rgba(0, 0, 0, 0.14),0px 3px 16px 2px rgba(0, 0, 0, 0.12);
}
.jss64 {
  box-shadow: 0px 6px 6px -3px rgba(0, 0, 0, 0.2),0px 10px 14px 1px rgba(0, 0, 0, 0.14),0px 4px 18px 3px rgba(0, 0, 0, 0.12);
}
.jss65 {
  box-shadow: 0px 6px 7px -4px rgba(0, 0, 0, 0.2),0px 11px 15px 1px rgba(0, 0, 0, 0.14),0px 4px 20px 3px rgba(0, 0, 0, 0.12);
}
.jss66 {
  box-shadow: 0px 7px 8px -4px rgba(0, 0, 0, 0.2),0px 12px 17px 2px rgba(0, 0, 0, 0.14),0px 5px 22px 4px rgba(0, 0, 0, 0.12);
}
.jss67 {
  box-shadow: 0px 7px 8px -4px rgba(0, 0, 0, 0.2),0px 13px 19px 2px rgba(0, 0, 0, 0.14),0px 5px 24px 4px rgba(0, 0, 0, 0.12);
}
.jss68 {
  box-shadow: 0px 7px 9px -4px rgba(0, 0, 0, 0.2),0px 14px 21px 2px rgba(0, 0, 0, 0.14),0px 5px 26px 4px rgba(0, 0, 0, 0.12);
}
.jss69 {
  box-shadow: 0px 8px 9px -5px rgba(0, 0, 0, 0.2),0px 15px 22px 2px rgba(0, 0, 0, 0.14),0px 6px 28px 5px rgba(0, 0, 0, 0.12);
}
.jss70 {
  box-shadow: 0px 8px 10px -5px rgba(0, 0, 0, 0.2),0px 16px 24px 2px rgba(0, 0, 0, 0.14),0px 6px 30px 5px rgba(0, 0, 0, 0.12);
}
.jss71 {
  box-shadow: 0px 8px 11px -5px rgba(0, 0, 0, 0.2),0px 17px 26px 2px rgba(0, 0, 0, 0.14),0px 6px 32px 5px rgba(0, 0, 0, 0.12);
}
.jss72 {
  box-shadow: 0px 9px 11px -5px rgba(0, 0, 0, 0.2),0px 18px 28px 2px rgba(0, 0, 0, 0.14),0px 7px 34px 6px rgba(0, 0, 0, 0.12);
}
.jss73 {
  box-shadow: 0px 9px 12px -6px rgba(0, 0, 0, 0.2),0px 19px 29px 2px rgba(0, 0, 0, 0.14),0px 7px 36px 6px rgba(0, 0, 0, 0.12);
}
.jss74 {
  box-shadow: 0px 10px 13px -6px rgba(0, 0, 0, 0.2),0px 20px 31px 3px rgba(0, 0, 0, 0.14),0px 8px 38px 7px rgba(0, 0, 0, 0.12);
}
.jss75 {
  box-shadow: 0px 10px 13px -6px rgba(0, 0, 0, 0.2),0px 21px 33px 3px rgba(0, 0, 0, 0.14),0px 8px 40px 7px rgba(0, 0, 0, 0.12);
}
.jss76 {
  box-shadow: 0px 10px 14px -6px rgba(0, 0, 0, 0.2),0px 22px 35px 3px rgba(0, 0, 0, 0.14),0px 8px 42px 7px rgba(0, 0, 0, 0.12);
}
.jss77 {
  box-shadow: 0px 11px 14px -7px rgba(0, 0, 0, 0.2),0px 23px 36px 3px rgba(0, 0, 0, 0.14),0px 9px 44px 8px rgba(0, 0, 0, 0.12);
}
.jss78 {
  box-shadow: 0px 11px 15px -7px rgba(0, 0, 0, 0.2),0px 24px 38px 3px rgba(0, 0, 0, 0.14),0px 9px 46px 8px rgba(0, 0, 0, 0.12);
}
.jss85 {
  color: inherit;
  cursor: pointer;
  margin: 0;
  border: 0;
  display: inline-flex;
  padding: 0;
  outline: none;
  position: relative;
  user-select: none;
  align-items: center;
  border-radius: 0;
  vertical-align: middle;
  justify-content: center;
  -moz-appearance: none;
  text-decoration: none;
  background-color: transparent;
  -webkit-appearance: none;
  -webkit-tap-highlight-color: transparent;
}
.jss85::-moz-focus-inner {
  border-style: none;
}
.jss85.jss86 {
  cursor: default;
  pointer-events: none;
}
.jss79 {
  flex: 0 0 auto;
  color: rgba(0, 0, 0, 0.54);
  padding: 12px;
  overflow: visible;
  font-size: 1.5rem;
  text-align: center;
  transition: background-color 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;
  border-radius: 50%;
}
.jss79:hover {
  background-color: rgba(0, 0, 0, 0.08);
}
.jss79.jss83 {
  color: rgba(0, 0, 0, 0.26);
}
@media (hover: none) {
  .jss79:hover {
    background-color: transparent;
  }
}
.jss79:hover.jss83 {
  background-color: transparent;
}
.jss80 {
  color: inherit;
}
.jss81 {
  color: #00bcd4;
}
.jss81:hover {
  background-color: rgba(0, 188, 212, 0.08);
}
@media (hover: none) {
  .jss81:hover {
    background-color: transparent;
  }
}
.jss82 {
  color: #f50057;
}
.jss82:hover {
  background-color: rgba(245, 0, 87, 0.08);
}
@media (hover: none) {
  .jss82:hover {
    background-color: transparent;
  }
}
.jss84 {
  width: 100%;
  display: flex;
  align-items: inherit;
  justify-content: inherit;
}
.jss88 {
  fill: currentColor;
  width: 1em;
  height: 1em;
  display: inline-block;
  font-size: 24px;
  transition: fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;
  user-select: none;
  flex-shrink: 0;
}
.jss89 {
  color: #00bcd4;
}
.jss90 {
  color: #f50057;
}
.jss91 {
  color: rgba(0, 0, 0, 0.54);
}
.jss92 {
  color: #f44336;
}
.jss93 {
  color: rgba(0, 0, 0, 0.26);
}
.jss94 {
  font-size: inherit;
}
.jss95 {
  font-size: 20px;
}
.jss96 {
  font-size: 36px;
}
.jss2 {
  z-index: 1201;
  background-color: #eff3f6;
}
.jss3 {
  height: 64px;
  display: flex;
  justify-content: space-between;
}
.jss4 {
  display: flex;
  align-items: center;
}
.jss5 {
  text-decoration: none;
}
.jss6 {
  color: #000;
}
@media (min-width:960px) {
  .jss6 {
    display: none;
  }
}
.jss1 {
  background-color: #fafafa;
}
@media (min-width:0px) and (max-width:599.95px) {
  .jss26 {
    display: none;
  }
}
@media (min-width:0px) {
  .jss27 {
    display: none;
  }
}
@media (max-width:599.95px) {
  .jss28 {
    display: none;
  }
}
@media (min-width:600px) and (max-width:959.95px) {
  .jss29 {
    display: none;
  }
}
@media (min-width:600px) {
  .jss30 {
    display: none;
  }
}
@media (max-width:959.95px) {
  .jss31 {
    display: none;
  }
}
@media (min-width:960px) and (max-width:1279.95px) {
  .jss32 {
    display: none;
  }
}
@media (min-width:960px) {
  .jss33 {
    display: none;
  }
}
@media (max-width:1279.95px) {
  .jss34 {
    display: none;
  }
}
@media (min-width:1280px) and (max-width:1919.95px) {
  .jss35 {
    display: none;
  }
}
@media (min-width:1280px) {
  .jss36 {
    display: none;
  }
}
@media (max-width:1919.95px) {
  .jss37 {
    display: none;
  }
}
@media (min-width:1920px) {
  .jss38 {
    display: none;
  }
}
@media (min-width:1920px) {
  .jss39 {
    display: none;
  }
}
@media (min-width:0px) {
  .jss40 {
    display: none;
  }
}
.jss97 {
  margin: 0;
  display: block;
}
.jss98 {
  color: rgba(0, 0, 0, 0.54);
  font-size: 7rem;
  font-weight: 300;
  font-family: Roboto;
  line-height: 1.14286em;
  margin-left: -.04em;
  letter-spacing: -.04em;
}
.jss99 {
  color: rgba(0, 0, 0, 0.54);
  font-size: 3.5rem;
  font-weight: 400;
  font-family: Roboto;
  line-height: 1.30357em;
  margin-left: -.02em;
  letter-spacing: -.02em;
}
.jss100 {
  color: rgba(0, 0, 0, 0.54);
  font-size: 2.8125rem;
  font-weight: 400;
  font-family: Roboto;
  line-height: 1.13333em;
  margin-left: -.02em;
}
.jss101 {
  color: rgba(0, 0, 0, 0.54);
  font-size: 2.125rem;
  font-weight: 400;
  font-family: Roboto;
  line-height: 1.20588em;
}
.jss102 {
  color: rgba(0, 0, 0, 0.87);
  font-size: 1.5rem;
  font-weight: 400;
  font-family: Roboto;
  line-height: 1.35417em;
}
.jss103 {
  color: rgba(0, 0, 0, 0.87);
  font-size: 1.3125rem;
  font-weight: 500;
  font-family: Roboto;
  line-height: 1.16667em;
}
.jss104 {
  color: rgba(33,33,33,.8);
  font-size: 16px;
  font-weight: 400;
  font-family: Roboto;
  line-height: 1.5em;
}
.jss105 {
  color: rgba(0, 0, 0, 0.87);
  font-size: 0.875rem;
  font-weight: 500;
  font-family: Roboto;
  line-height: 1.71429em;
}
.jss106 {
  color: rgba(0, 0, 0, 0.87);
  font-size: 0.875rem;
  font-weight: 400;
  font-family: Roboto;
  line-height: 1.46429em;
}
.jss107 {
  color: rgba(0, 0, 0, 0.54);
  font-size: 0.75rem;
  font-weight: 400;
  font-family: Roboto;
  line-height: 1.375em;
}
.jss108 {
  color: rgba(0, 0, 0, 0.87);
  font-size: 0.875rem;
  font-weight: 500;
  font-family: Roboto;
  text-transform: uppercase;
}
.jss109 {
  width: 1px;
  height: 1px;
  position: absolute;
  overflow: hidden;
}
.jss110 {
  text-align: left;
}
.jss111 {
  text-align: center;
}
.jss112 {
  text-align: right;
}
.jss113 {
  text-align: justify;
}
.jss114 {
  overflow: hidden;
  white-space: nowrap;
  text-overflow: ellipsis;
}
.jss115 {
  margin-bottom: 0.35em;
}
.jss116 {
  margin-bottom: 16px;
}
.jss117 {
  color: inherit;
}
.jss118 {
  color: #00bcd4;
}
.jss119 {
  color: #f50057;
}
.jss120 {
  color: rgba(0, 0, 0, 0.87);
}
.jss121 {
  color: rgba(0, 0, 0, 0.54);
}
.jss122 {
  color: #f44336;
}
.jss41 {
  flex: 0 0 auto;
}
.jss42 {
  top: 0;
  flex: 1 0 auto;
  height: 100%;
  display: flex;
  z-index: 1200;
  outline: none;
  position: fixed;
  overflow-y: auto;
  flex-direction: column;
  -webkit-overflow-scrolling: touch;
}
.jss43 {
  left: 0;
  right: auto;
}
.jss44 {
  left: auto;
  right: 0;
}
.jss45 {
  top: 0;
  left: 0;
  right: 0;
  bottom: auto;
  height: auto;
  max-height: 100%;
}
.jss46 {
  top: auto;
  left: 0;
  right: 0;
  bottom: 0;
  height: auto;
  max-height: 100%;
}
.jss47 {
  border-right: 1px solid rgba(0, 0, 0, 0.12);
}
.jss48 {
  border-bottom: 1px solid rgba(0, 0, 0, 0.12);
}
.jss49 {
  border-left: 1px solid rgba(0, 0, 0, 0.12);
}
.jss50 {
  border-top: 1px solid rgba(0, 0, 0, 0.12);
}
.jss123 {
  font-size: 16px;
  margin-top: 32px;
  font-family: &#x27;Helvetica Neue&#x27;,Helvetica,Arial,Sans-serif;
  line-height: 2.2;
}
.jss123 h2 {
  color: rgba(0, 0, 0, 0.87);
  font-size: 21px;
  margin-top: 40px;
  font-weight: 500;
}
.jss123 pre {
  padding: 24px;
  overflow: auto;
  font-size: 14px;
  font-family: Roboto, monospace;
  background-color: #fff;
}
.jss123 a {
  color: #45c289;
  font-style: normal;
  word-break: break-word;
}
.jss123 img {
  width: 100%;
  margin: 16px auto;
  display: block;
}
.jss123 blockquote {
  margin: 0;
  padding: 16px 32px;
  border-left: 4px solid #45c289;
  border-radius: 3px;
  background-color: #fff;
}
.jss123 p {
  color: rgba(0, 0, 0, 0.75);
  font-size: 16px;
  word-break: break-word;
}
.jss123 h2:before {
  height: 91px;
  content: &quot;&quot;;
  display: block;
  margin-top: -91px;
  visibility: hidden;
}
.jss123 h2 a {
  visibility: hidden;
}
.jss123 h2:hover a {
  cursor: pointer;
  visibility: visible;
  text-decoration: none;
}
@media (min-width:960px) {
  .jss15 {
    display: none;
  }
}
.jss16 {
  min-height: 56px;
}
@media (min-width:0px) and (orientation: landscape) {
  .jss16 {
    min-height: 48px;
  }
}
@media (min-width:600px) {
  .jss16 {
    min-height: 64px;
  }
}
.jss17 {
  display: flex;
  align-items: center;
  border-bottom: 1px solid #eee;
}
.jss18 {
  width: 298px;
  justify-content: space-between;
}
.jss19 {
  margin-top: 16px;
}
.jss20 {
  display: block;
  padding: 8px  16px;
  text-decoration: none;
}
.jss20:hover {
  background-color: #EEEEEE;
}
.jss20.active .jss21 {
  border-left: 4px solid #45c289;
  font-weight: 600;
}
.jss21 {
  padding-left: 8px;
}
.jss22 {
  flex-grow: 1;
}
.jss23 {
  display: flex;
  padding: 16px;
  border-top: 1px solid #eee;
  flex-shrink: 0;
  align-items: center;
  text-decoration: none;
}
.jss24 {
  color: rgba(33,33,33,.54);
  width: 16px;
  height: 16px;
}
.jss25 {
  color: #45c289;
  padding-left: 8px;
}
.jss124 {
  display: flex;
  margin-top: 64px;
  margin-bottom: 48px;
  justify-content: space-between;
}
.jss125 {
  width: 48%;
}
.jss126 {
  width: 48%;
  border: 1px solid #E6ECF1;
  display: flex;
  padding: 16px;
  max-width: 320px;
  box-shadow: 0 3px 8px 0 rgba(116, 129, 141, 0.1);
  align-items: center;
  justify-content: space-between;
  text-decoration: none;
}
.jss127 {
  color: rgba(33,33,33,.8);
}
.jss128 {
  text-align: right;
}
.jss129 {
  margin-bottom: 8px;
}
.jss7 {
  display: flex;
  margin-top: 64px;
  margin-bottom: 64px;
}
.jss8 {
  width: 100%;
  padding: 0 24px;
}
@media (min-width:960px) {
  .jss8 {
    width: calc(100% - 298px);
    margin-left: 298px;
  }
}
.jss9 {
  width: 100%;
  margin: 24px auto;
  max-width: 640px;
  overflow-y: auto;
}
.jss10 {
  font-size: 26px;
  margin-top: 16px;
  font-weight: 500;
  margin-bottom: 32px;
}
.jss11 {
  display: flex;
  margin-top: 32px;
  align-items: center;
  text-decoration: none;
}
.jss11 h3 {
  margin-left: 8px;
}
.jss12 {
  color: #45c289;
  border-bottom: 1px solid #45c289;
}
.jss13 {
  height: 1px;
  border: none;
  margin-top: 48px;
  margin-bottom: 24px;
  background-color: #f5f3f7;
}
.jss14 {
  display: flex;
  align-items: center;
  justify-content: flex-end;
  text-decoration: none;
}
.jss14 p {
  color: #45c289;
  margin-left: 4px;
}</style><script type="text/javascript" src="//cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-126744557-1"></script><script>
                  window.dataLayer = window.dataLayer || [];
                  function gtag(){dataLayer.push(arguments);}
                  gtag('js', new Date());
                  gtag('config', 'UA-126744557-1');
                </script><script type="text/javascript">window.__CSS_CHUNKS__ = {"main":"/nrocks/styles.de08a35c.css"}</script><script type="text/javascript">
    window.__routeInfo = {"path":"nerv-first/12-react","templateID":2,"sharedPropsHashes":{"course":"Z7f6Hh","episodes":"29wNOR"},"localProps":null,"allProps":{"course":{"id":"nerv-first","title":"基于 Nervos AppChain 的 DApp 开发","desc":"手把手教你开发 DApp","image":"https://img.haoqicat.com/2018102602.jpg","date":"2018-09-24"},"episodes":[{"id":"0-intro","title":"课程简介","video":"https://www.bilibili.com/video/av32333562/"},{"id":"1-dapp","title":"什么是 DApp ？","video":"https://www.bilibili.com/video/av32372347/"},{"id":"2-nervos","title":"什么是 Nervos ？","video":"https://www.bilibili.com/video/av32475946/"},{"id":"3-dev","title":"智能合约入门","video":"https://www.bilibili.com/video/av32476063"},{"id":"4-sol","title":"合约编程语言 Solidity","video":"https://www.bilibili.com/video/av32476109"},{"id":"5-rpc","title":"HTTP 请求和 JSON-RPC","video":"https://www.bilibili.com/video/av32476177"},{"id":"6-wallet","title":"什么是加密货币钱包？","video":"https://www.bilibili.com/video/av32530740/"},{"id":"7-coin","title":"申请测试链代币","video":"https://www.bilibili.com/video/av32530826/"},{"id":"8-deploy-1","title":"部署智能合约 part1","video":"https://www.bilibili.com/video/av32530899/"},{"id":"9-deploy-2","title":"部署智能合约 part2","video":"https://www.bilibili.com/video/av32531067/"},{"id":"10-interact","title":"与合约交互","video":"https://www.bilibili.com/video/av32531356/"},{"id":"11-gas","title":"以太坊的 Gas 机制","video":"https://www.bilibili.com/video/av32531510/"},{"id":"12-react","title":"基于 React 开发 DApp","video":"https://www.bilibili.com/video/av32531648/"},{"id":"13-neuron","title":"Neuron 钱包作为 DApp 的运行环境","video":"https://www.bilibili.com/video/av32531808/"}],"episode":{"id":"12-react","title":"基于 React 开发 DApp","video":"https://www.bilibili.com/video/av32531648/"},"markdown":"之前完成了使用 Nodejs 脚本的形式跟合约进行交互，但是实际上用户还是希望能有一个美观的 UI 可以用的。所以这节咱们就来基于 react 技术开发 DApp ，实现跟合约的交互。本节的最终代码都在 Github 仓库中的 dapp1 文件夹中：https://github.com/happypeter/NervFirst/tree/master/dapp1 。下面我们来说说具体的开发思路。\n\n\n## 总体思路\n\n先来说说 DApp 的总体架构。起码截止到目前，DApp 开发还是以 Web 架构为主，也就是说是可以跑到浏览器内的。本节我们使用 React 技术来开发 DApp 应用，这个在业界也是非常流行的，例如著名的 steemit 项目就是用 react 开发的，当然理论上讲任何的 Web 技术，或者是用 ios 或者 andriod 原生应用都可以开发 DApp 的。\n\n我们本节开发的 DApp 跟真实的 DApp 还是有一个明显的不同，因为本节会承接上一节，继续把 DApp 使用者的账户信息，包括私钥，保存到源码中。这样，当 DApp 跟合约交互的时候，底层的 Nervos.js 会直接调用私钥进行签名，整个签名过程从界面上是看不到的。后续的小节中，我们会把私钥信息移除，采用 Nervos 官方的 DApp 钱包 neuron 来完成交易签名，不带私钥的源码才是正确的开发 DApp 的方式，因为只有这样每个用户才可以用自己的 Neuron 钱包打开 DApp ，去使用自己的账户去发交易，跟合约进行交互。当然这是后话。\n\n本节中我们基本的思路就是把之前 interact 文件夹中的必要文件都拷贝到 react 项目中，然后就可以在浏览器中去跟智能合约进行交互了。\n\n## 实现读取操作\n\n先来创建一个新的 react 项目，然后把必要的文件内容拷贝过来，实现读取链上数据的操作。\n\n```\ncreate-react-app dapp1\nyarn add @nervos/chain\n```\n\n\n我们通过 create-react-app 这个脚手架工具来生成项目，如果系统上没有这个命令需要提前 npm 全局安装一下。项目的名字叫 dapp1 ，在本文开始给大家的链接中可以看到 dapp1 中的最终代码。进入项目安装一下 Nervos.js 。\n\n\n下面把 interact/ 中的各个不需要改动的文件直接拷贝到 dapp1/src 中。 需要拷贝的文件包括 config.js ，nervos.js ，simpleStore.js 和 transaction.js 。\n\n\nApp.js\n\n\n```js\nconst nervos = require('./nervos')\nconst simpleStore = require('./simpleStore')\n\n componentDidMount = async () => {\n    const from =\n      nervos.appchain.accounts.wallet[0] &&\n      nervos.appchain.accounts.wallet[0].address\n\n    console.log('from', from)\n\n    const times = await simpleStore.simpleStoreContract.methods.getList().call({\n      from\n    })\n    console.log('times', times)\n    const messages = await Promise.all(\n      times.map(time =>\n        simpleStore.simpleStoreContract.methods.get(time).call({ from })\n      )\n    )\n    console.log('messages', messages)\n  }\n```\n\n接下来到 App.js 中完成读取链上数据的操作。首先导入 nervos 和 simpleStore ，然后需要添加一个异步的 `componentDidMount` 函数，这个函数会在页面加载后自动执行。里面的内容就直接拷贝 interact/index.js 中的读取相关的代码即可。\n\n```\nyarn start\n```\n\n启动项目，浏览器中打开 console 可以看到顺利读取到了链上的数据。\n\n## 写操作\n\n接下来完成写操作。也是基本拷贝 interact/index.js 中的内容，配上一点点 React 的受控组件的小知识。\n\n\nApp.js\n\n```js\nclass App extends Component {\n  state = {\n    msg: ''\n  }\n  handleChange = e => {\n    this.setState({\n      msg: e.target.value\n    })\n  }\n  handleSubmit = async e => {\n    e.preventDefault()\n    const { msg } = this.state\n    const time = new Date()\n\n    const current = await nervos.appchain.getBlockNumber()\n    const tx = {\n      ...simpleStore.transaction,\n      validUntilBlock: +current + 88\n    }\n    const res = await simpleStore.simpleStoreContract.methods\n      .add(msg, +time)\n      .send(tx)\n\n    const receipt = await nervos.listeners.listenToTransactionReceipt(res.hash)\n    receipt.errorMessage && console.log(receipt.errorMessage)\n    this.setState({\n      msg: ''\n    })\n  }\n  ...\n      <form onSubmit={this.handleSubmit}>\n          <label>\n            Name:\n            <input\n              type=\"text\"\n              value={this.state.msg}\n              onChange={this.handleChange}\n            />\n          </label>\n          <input type=\"submit\" value=\"Submit\" />\n        </form>\n\n```\n\n添加的 state 值以及 handleChange 函数以及下面的 render 函数中的 form 都是 react 的基础知识，联合起来构成了一个 react 的受控的 input 组件。目的只有一个就是拿到用户输入的字符串。点提交按钮的时候，handleSubmit 函数就会执行。里面可以通过 this.state.msg 拿到用户输入的字符串。所以 react 的内容就是这些。handleSubmit 中其余的内容，跟 interact/index.js 就没有什么区别了。\n\n\n浏览器中，提交一个留言，点下提交按钮后，界面会僵住几秒钟，当数据写入成功后，input 中的字符串被清空，表示提交成功了。刷新一下页面，终端中也可以看到最新提交的数据。\n\n## 总结\n\n到这里，我们就把之前的 interact/ 中实现的跟合约的交互功能移动到 DApp 中了。我们没有实现特别完善的用户体验，因为剩下的工作都是 react 相关技巧了，不是我们本课程的重点。官方的 Demo 仓库中的 first_forever 项目就是最终的效果大家可以去参考：https://github.com/cryptape/dapp-demos/tree/master/first_forever 。\n\n同时在咱们课程的仓库中，我也做了镜像：https://github.com/happypeter/NervFirst/tree/master/complete/first_forever 。\n"},"siteData":{"title":"nervos"}};</script><script defer="" type="text/javascript" src="/nrocks/bootstrap.2a9c3808.js"></script><script defer="" type="text/javascript" src="/nrocks/templates/src/containers/EpisodeContainer.53a275f5.js"></script><script defer="" type="text/javascript" src="/nrocks/main.727cb2d6.js"></script></body></html>